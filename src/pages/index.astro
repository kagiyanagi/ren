---
import Hero from "@/components/Hero.astro";
import Breadcrumb from "@/components/Breadcrumb.astro";
import Section from "@/components/Section.astro";
import ProjectCard from "@/components/ProjectCard.astro";
import Layout from "@/layouts/Layout.astro";
import Contact from "@/components/Contact.astro";
import { Image } from "astro:assets";
import VillainImg from "@/villain.png";
import House from "@/house.gif";
import { KNOWN_TECH, PROJECTS } from "@/consts";
const GITHUB_REPO = "kagiyanagi/ren";
let commitISO = null;
try {
  const res = await fetch(
    `https://api.github.com/repos/${GITHUB_REPO}/commits?per_page=1`,
  );
  if (res.ok) {
    const json = await res.json();
    commitISO =
      json?.[0]?.commit?.committer?.date ??
      json?.[0]?.commit?.author?.date ??
      null;
  } else {
    console.error("GitHub API responded with status", res.status);
  }
} catch (err) {
  console.error("Failed fetching latest commit:", err);
}
---

<Layout title="Aman - Engineer, GFX designer and High school student">
  <Hero />
  <Section
    title="About me"
    className={"max-w-screen-2xl mx-auto flex flex-col gap-8 items-center"}
  >
    <div
      class="w-full grid place-items-center gap-4 grid-cols-1 sm:grid-cols-2"
    >
      <div class="w-full flex justify-center">
        <Image
          alt="Profile illustration"
          src={VillainImg}
          class="brightness-200 max-w-xs sm:max-w-sm md:max-w-md object-contain invert"
        />
      </div>

      <div
        class="w-full flex flex-col justify-center text-lg sm:text-xl gap-4 max-w-screen-md"
      >
        <h3
          class="text-2xl sm:text-4xl opacity-95 mb-4 flex items-center gap-4 flex-col sm:flex-row"
        >
          Hi, I'm Aman <span class="text-xl text-[#CCCCCC]"
            >(A.K.A kagiyanagi/ren/aqua).</span
          >
        </h3>
        <p class="opacity-95">
          I'm a self-taught engineer and passionate tech guy from India,
          currently in high school. My interests span a wide range in Computer
          Science, including:
        </p>
        <p class="opacity-95">
          Web development, IoT, Machine learning, Linux(Arch btw). I'm a big fan
          of anime (<a
            class="underline transition-all"
            href="https://myanimelist.net/profile/kagiyanagi">MAL link</a
          >) and music, which both inspire my creativity. Core Android
          development: I love building custom ROMs and kernels. I've archived
          everything on my
          <a class="underline transition-all" href="https://t.me/rensakashvani"
            >Telegram channel</a
          >
        </p>
        <p class="opacity-95">
          Right now I'm mostly focused on high school (you know how it is), but
          I'm still highly motivated and committed to continuous learning and
          growth in the tech world.
        </p>
        <p
          id="lastUpdated"
          class="text-zinc-600 text-xl custom-cursor-help"
          title="This data is coming from my GitHub repository's latest commit."
          data-commit={commitISO}
        >
          Last updated: loading…
        </p>

        <script>
          const el = document.getElementById("lastUpdated");
          const commitISO = el?.dataset?.commit || null;
          const commitTime = commitISO ? new Date(commitISO).getTime() : null;

          function updateSince() {
            if (!commitTime) {
              el.textContent = "Last updated: unknown";
              return;
            }

            const now = Date.now();
            let diff = now - commitTime;

            const ms = diff % 1000;
            diff = Math.floor(diff / 1000);

            const s = diff % 60;
            diff = Math.floor(diff / 60);

            const m = diff % 60;
            diff = Math.floor(diff / 60);

            const h = diff % 24;
            const d = Math.floor(diff / 24);

            el.textContent = `Last updated: ${d}d ${h}h ${m}m ${s}s ${ms}ms ago`;
          }

          updateSince();
          setInterval(updateSince, 16);
        </script>
      </div>
    </div>
  </Section>
  <Section title="Technologies i like" full_screen={false}>
    <div class="w-full grid place-items-center mb-12">
      <div class="w-full gap-4 flex flex-wrap max-w-2xl text-lg justify-center">
        {KNOWN_TECH.map((x) => <Breadcrumb title={x} />)}
      </div>
    </div>
  </Section>
  <Section
    title="My projects"
    className={"bg-gradient-to-b from-black/70 from-[5%] to-black via-black max-w-screen-2xl mx-auto items-center mb-12"}
  >
    <div class="w-full grid grid-cols-1 md:grid-cols-2 gap-4">
      {PROJECTS.map((project) => <ProjectCard {...project} />)}
    </div>
  </Section>
  <Section
    title="Contact me"
    className={"max-w-screen-2xl mx-auto flex flex-col gap-8 items-center"}
  >
    <div
      class="w-full grid place-items-center grid-cols-1 sm:grid-cols-2 gap-12 sm:gap-0"
    >
      <div class="flex flex-col items-center">
        <Image
          alt="FBFBFBFBFBFB massage by Moeka Kiryū from Steins;Gate. GIF on http://anime.en.utf8art.com/arc/steins_gate_11.html"
          src={House}
          class="brightness-200 max-w-xs sm:max-w-sm"
        />
      </div>
      <div class="w-full max-w-xl">
        <Contact />
      </div>
    </div>
  </Section>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll("a").forEach((link) => {
        if (link.href) {
          link.target = "_blank";
          link.rel = "noopener noreferrer";
        }
      });
    });
  </script>
</Layout>
